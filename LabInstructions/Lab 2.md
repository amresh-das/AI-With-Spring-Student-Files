## Lab 2 - QuickStart - OpenAI

- In this exercise you will create a simple Spring Boot application which can make calls to OpenAI.  You will need to establish credentials with OpenAI first, so let's take care of that now.

**Part 1 - Signup Process for OpenAI**

NOTE:  The AI industry changes rapidly.  The instructions here were valid as of May 2024.  You may find the screens and terminology have updated since these instructions were recorded.

1. Go to https://platform.openai.com/signup
Login or signup for an account.  I recommend the signup option using Google, Microsoft, Apple, etc. 
2. This will take you to an initial page welcoming you to the OpenAI Developer Platform.  Once here you can create API Keys at https://platform.openai.com/api-keys.
3. Create a new secret key.  Choose the “service account” option.  Make a service account ID such as “my-initial-key”.  For the project, you should have a default project associated with your default organization.
4. Create secret key.  COPY the generated key value.  Save this in a file for your records.  Ultimately you will place this in your application.yml file under the key spring.ai.openai.api-key.
* If you loose this key, don't worry.  You can easily create a new one if necessary.
* Note: You may have to establish a payment method if you have exhausted your free tier.  This can happen if you use ChatGPT frequently - like I do.


**Part 2 - Generate the Project Structure**

5.  Using [https://start.spring.io](https://start.spring.io), create a new Spring Boot Project.
  - Use either Maven or Gradle - Groovy (if you have it installed).  All lab instructions are based on Maven.
  - Use the latest stable releases of Boot and Java.  These instructions were originally tested with Java 1.21, Boot 3.2.5.  The version can be changed after the project is generated.
  - Use JAR packaging.
  - For project metadata, adjust the values as you like.  These instructions will assume an artifact and name of “ai-quickstart-openai”.
  - Adjust the package to “com.example” for simplicity.  You are free to re-arrange the package structure later.
  - Select the following dependencies: Web, OpenAI.
6. Generate.  Find the downloaded zip and expand it.  Copy the "ai-quickstart-openai" project to wherever you downloaded your labfiles to.

**Part 3 - Import into your IDE**

The project structure generated by Spring Initializr follows a Maven-type generic pattern and can be imported into various IDEs. You can use either VS Code (assuming the appropriate extensions are installed, see "Lab Setup"), IntelliJ, or Eclipse. 

The instructions below are for VS Code. If you wish to try IntilliJ or Eclipse and need assistance, see the "Lab Setup" document.

7. Open VS Code.

8. Open the project folder by using the File menu and select "Open Folder". Select the folder where you copied the files.
* Give VS Code a moment to initialize its workspace, especially if this is the first time importing a Gradle/Maven project.
* If you see a message about enabling null analysis for the project, you can select either enable or disable.
* If you see a message about installing “Extension Pack for Java”, take the install option.
* If you see a message "Do you trust the authors of the files in this folder", check the checkbox and click the "trust" button..

9. ***VS Code should*** recognize the project as a Maven or Gradle project and automatically import it. If it does not and you are using Gradle, you may need to manually import it:

* Open the Command Palette (Ctrl+Shift+P or Cmd+Shift+P on macOS).
* Type "Gradle: Import Gradle Project" and select it.
* Navigate to the project directory and select the build.gradle file.
* Click "Open".

10. If you get an error such as “invalid source release ” you may need to lower the Java version specified in your build.gradle file. 

* Open build.gradle
* Find the section on java / sourceCompatibility.
* Lower the Java version number. For example, if 21 is too high, try 17.

The project should be free of compiler errors at this point, but will

**Part 4 - Setup keys and test**

At this point, let's take a moment to ensure that everything we have created so far is error free.

11.  Within your IDE, create a file src/main/resources/application.yml.
12.  Create the following entry, except use the secret key you saved earlier:
```
spring:
  ai:
    openai:
      api-key: YOUR-KEY-GOES-HERE
```
13.  Save your work.  Open your main Application class - it should be in src/main/java/com/example if you have followed the instructions so far.

14.  Run the application.
* **VS Code**: Open src/main/java/com/webage folder and open Application.java. Click the a “Run” option hovering over the main() method.
* **IntelliJ**: Run the application by expanding the src/main/java folder, then the com.webage package. Right-click on the Application.java file. Select “Run ‘Application.main()’”. 
* **Eclipse**: Run the application by expanding the src/main/java folder, then the com.webage package. Right-click on the Application.java file. Select Run As / Java Application.

* We expect the application to start.  If you have any errors related to tooling, be sure to address them now before proceeding.

15.  Stop the application.
* **VS Code**: In the “TERMINAL” tab type “ctrl-c”, or press the trashcan icon.
* **IntelliJ**: Stop the application by clicking on the red “stop” button on the left edge of the console tab.
* **Eclipse**: Stop the application by clicking on the red “terminate” button on the console tab.

**Part 5 - Try Spring AI's ChatClient**

At this point we should be able to try using the ChatClient to make API calls to OpenAI.

16. Create a new test class in src/test/java/com/example (if you have been using the recommended package structure.)  Name the class "ChatClientTests.java".

17. Alter the test class to include the @SpringBootTest annotation.  Tell boot to run as a non-web application like this:  
```
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.NONE)
class ChatClientTests {
    //...
```

17. Add code to automatically provide a reference to the ChatClient.  Spring Boot automatically creates this when the Spring AI dependencies are on the classpath:
```
	@Autowired
	ChatClient chatClient;
```

18. Add a @Test method to use the chatClient to make an example API call:
```
	@Test
	void quickChat() {
		ChatResponse response = chatClient.call(
			new Prompt(
				"Generate the names of the five Great Lakes.",
					OpenAiChatOptions.builder()
						.withModel("gpt-3.5-turbo")
						.withTemperature(0.4f)
						.build()
				));

		Assertions.assertThat(response).isNotNull();
		Assertions.assertThat(response.getResults()).isNotEmpty();

		System.out.println("The results of the call are:");
		response.getResults().forEach(System.out::println);
	}

```

19. Supply any imports needed to make you code compile.
* **VS Code**: Type Alt-Shift-O.
* **IntelliJ**: Type Ctrl-Alt-O.
* **Eclipse**: Type Ctrl-Shift-O.

20.  Save your work. Run the test.
* **VS Code**: Notice the green triangle in the editor’s “gutter”. Click on this to run either an individual test method or all tests in the class.
* **IntelliJ**: Right-click on the class. Select Run ChatClientTests.
* **Eclipse**: Right-click on the class. Select Run As / Junit Test.

The test should run and produce a list of the five Great Lakes.  It is also very possible that you will encounter an error here, possibly due to setup, but also due to changes in OpenAPI since the time of this writing.  Here are some troubleshooting tips.
* If you have a compilation issue, be sure you have organized imports.  Compare your code to the solution code.
* If you receive a message that your token is invalid, return to the earlier steps to create a token and set it in application.yml.
* If you receive a message about exceeding your quota, you may need to convert to a paid subscription for OpenAI (I've had to do this, since I use it heavily).

